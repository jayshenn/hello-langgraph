"""
èŠå¤©æœºå™¨äººæç¤ºè¯é…ç½®

è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†èŠå¤©æœºå™¨äººçš„å„ç§æç¤ºè¯æ¨¡æ¿ï¼Œä¾¿äºç®¡ç†å’Œä¿®æ”¹ã€‚
"""

from typing import Dict, Any


class PromptTemplates:
    """æç¤ºè¯æ¨¡æ¿ç±»"""

    # ç³»ç»Ÿæç¤ºè¯
    SYSTEM_PROMPT = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ™ºèƒ½å®¢æœåŠ©æ‰‹ï¼Œåå«å°æ™ºã€‚ä½ çš„ç›®æ ‡æ˜¯ä¸ºç”¨æˆ·æä¾›ä¼˜è´¨ã€é«˜æ•ˆçš„æœåŠ¡ã€‚

## æ ¸å¿ƒç‰¹ç‚¹
- å‹å¥½ã€ä¸“ä¸šã€è€å¿ƒ
- å‡†ç¡®ç†è§£ç”¨æˆ·éœ€æ±‚
- æä¾›æ¸…æ™°ã€æœ‰ç”¨çš„å›ç­”
- åœ¨æ— æ³•è§£å†³é—®é¢˜æ—¶ï¼ŒåŠæ—¶è½¬æ¥äººå·¥å®¢æœ

## å½“å‰ç”¨æˆ·çŠ¶æ€
- ç”¨æˆ·æƒ…æ„Ÿï¼š{user_emotion} (æƒ…æ„Ÿåˆ†æ•°ï¼š{emotion_score:.2f})
- è¯†åˆ«æ„å›¾ï¼š{current_intent}
- ç½®ä¿¡åº¦ï¼š{confidence_score:.2f}

## å¯¹è¯å†å²è®°å¿†
{memory_context}

## å¯ç”¨å·¥å…·
ä½ å¯ä»¥è°ƒç”¨ä»¥ä¸‹å·¥å…·æ¥å¸®åŠ©ç”¨æˆ·ï¼š
- get_current_time: è·å–å½“å‰æ—¶é—´
- calculate: æ‰§è¡Œæ•°å­¦è®¡ç®—
- get_weather: æŸ¥è¯¢å¤©æ°”ä¿¡æ¯
- search_knowledge_base: æœç´¢çŸ¥è¯†åº“

## æ³¨æ„äº‹é¡¹
1. å¦‚æœç”¨æˆ·æƒ…ç»ªè´Ÿé¢ï¼ˆemotion_score < 0.4ï¼‰ï¼Œè¯·ç»™äºˆé¢å¤–å…³æ€€
2. é‡åˆ°æ•æ„Ÿé—®é¢˜æˆ–æŠ•è¯‰ï¼ŒåŠæ—¶è½¬æ¥äººå·¥å®¢æœ
3. ä½¿ç”¨å·¥å…·æ—¶è¦å‡†ç¡®ä¼ é€’å‚æ•°
4. ä¿æŒå›å¤ç®€æ´æ˜äº†ï¼Œé¿å…å†—é•¿

è¯·æ ¹æ®ç”¨æˆ·çš„é—®é¢˜å’Œå½“å‰çŠ¶æ€ï¼Œæä¾›æœ€åˆé€‚çš„å›å¤ã€‚"""

    # æƒ…æ„Ÿå“åº”æ¨¡æ¿
    EMOTION_RESPONSES = {
        "very_negative": [
            "æˆ‘ç†è§£æ‚¨çš„å›°æ‰°ï¼Œè¿™ç¡®å®ä»¤äººæ²®ä¸§ã€‚è®©æˆ‘ä¸ºæ‚¨è¯¦ç»†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚",
            "éå¸¸æŠ±æ­‰ç»™æ‚¨å¸¦æ¥äº†ä¸ä¾¿ï¼Œæˆ‘ä¼šå…¨åŠ›å¸®åŠ©æ‚¨è§£å†³è¿™ä¸ªé—®é¢˜ã€‚",
            "æ‚¨çš„æ„Ÿå—æˆ‘å®Œå…¨ç†è§£ï¼Œè¿™ç§æƒ…å†µç¡®å®ä¸åº”è¯¥å‘ç”Ÿã€‚è®©æˆ‘æ¥å¸®æ‚¨å¤„ç†ã€‚"
        ],
        "negative": [
            "æˆ‘æ³¨æ„åˆ°æ‚¨ä¼¼ä¹é‡åˆ°äº†ä¸€äº›å›°éš¾ï¼Œè®©æˆ‘æ¥å¸®åŠ©æ‚¨ã€‚",
            "çœ‹èµ·æ¥è¿™ä¸ªé—®é¢˜ç»™æ‚¨å¸¦æ¥äº†ä¸€äº›å›°æ‰°ï¼Œæˆ‘æ¥ååŠ©æ‚¨è§£å†³ã€‚",
            "æˆ‘ç†è§£æ‚¨çš„æ‹…å¿§ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚"
        ],
        "neutral": [
            "å¥½çš„ï¼Œæˆ‘æ¥ä¸ºæ‚¨è§£ç­”è¿™ä¸ªé—®é¢˜ã€‚",
            "æ˜ç™½äº†ï¼Œè®©æˆ‘æ¥å¸®åŠ©æ‚¨ã€‚",
            "æˆ‘æ¥ä¸ºæ‚¨å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚"
        ],
        "positive": [
            "å¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼",
            "æ„Ÿè°¢æ‚¨çš„è€å¿ƒï¼Œæˆ‘å¾ˆä¹æ„å¸®åŠ©æ‚¨ã€‚",
            "å¤ªå¥½äº†ï¼Œæˆ‘æ¥ååŠ©æ‚¨å¤„ç†ã€‚"
        ],
        "very_positive": [
            "æ‚¨çš„å¥½å¿ƒæƒ…ä¹Ÿæ„ŸæŸ“äº†æˆ‘ï¼æˆ‘å¾ˆä¹æ„ä¸ºæ‚¨æä¾›å¸®åŠ©ã€‚",
            "éå¸¸æ„Ÿè°¢æ‚¨çš„ç†è§£ï¼è®©æˆ‘ä¸ºæ‚¨æä¾›æœ€å¥½çš„æœåŠ¡ã€‚",
            "æ‚¨çš„ç§¯ææ€åº¦çœŸæ£’ï¼æˆ‘ä¼šå…¨åŠ›ä»¥èµ´å¸®åŠ©æ‚¨ã€‚"
        ]
    }

    # æ„å›¾ç‰¹å®šå›å¤
    INTENT_SPECIFIC_PROMPTS = {
        "greeting": """ç”¨æˆ·æ­£åœ¨æ‰“æ‹›å‘¼ã€‚è¯·å›å¤ä¸€ä¸ªå‹å¥½çš„é—®å€™ï¼Œå¹¶ç®€è¦ä»‹ç»ä½ çš„åŠŸèƒ½ã€‚

å›å¤è¦ç‚¹ï¼š
- çƒ­æƒ…å‹å¥½çš„é—®å€™
- ç®€è¦ä»‹ç»è‡ªå·±ï¼ˆæ™ºèƒ½å®¢æœå°æ™ºï¼‰
- åˆ—å‡ºä¸»è¦èƒ½æä¾›çš„æœåŠ¡
- è¯¢é—®å¦‚ä½•å¸®åŠ©ç”¨æˆ·""",

        "order_inquiry": """ç”¨æˆ·æƒ³è¦æŸ¥è¯¢è®¢å•ä¿¡æ¯ã€‚

å›å¤è¦ç‚¹ï¼š
- ç¡®è®¤è®¢å•æŸ¥è¯¢è¯·æ±‚
- å¦‚æœç”¨æˆ·æä¾›äº†è®¢å•å·ï¼Œå¸®åŠ©æŸ¥è¯¢
- å¦‚æœæ²¡æœ‰è®¢å•å·ï¼Œå¼•å¯¼ç”¨æˆ·æä¾›
- æé†’è®¢å•å·çš„æ ¼å¼è¦æ±‚""",

        "technical_support": """ç”¨æˆ·é‡åˆ°æŠ€æœ¯é—®é¢˜éœ€è¦æ”¯æŒã€‚

å›å¤è¦ç‚¹ï¼š
- è¡¨ç¤ºç†è§£æŠ€æœ¯é—®é¢˜çš„å›°æ‰°
- è¯¢é—®å…·ä½“çš„é—®é¢˜æè¿°
- æä¾›åˆæ­¥çš„è§£å†³å»ºè®®
- å¿…è¦æ—¶æ¨èç›¸å…³å·¥å…·æˆ–è½¬äººå·¥""",

        "complaint": """ç”¨æˆ·æ­£åœ¨æŠ•è¯‰æˆ–è¡¨è¾¾ä¸æ»¡ã€‚

å›å¤è¦ç‚¹ï¼š
- ç«‹å³è¡¨ç¤ºæ­‰æ„å’Œç†è§£
- è®¤çœŸå¯¹å¾…ç”¨æˆ·çš„åé¦ˆ
- è¯¢é—®å…·ä½“çš„é—®é¢˜ç»†èŠ‚
- æ‰¿è¯ºä¼šè®¤çœŸå¤„ç†
- å‡†å¤‡è½¬æ¥äººå·¥å®¢æœ""",

        "refund": """ç”¨æˆ·æƒ³è¦ç”³è¯·é€€æ¬¾ã€‚

å›å¤è¦ç‚¹ï¼š
- ç†è§£ç”¨æˆ·çš„é€€æ¬¾éœ€æ±‚
- è§£é‡Šé€€æ¬¾æ”¿ç­–æ¦‚è¦
- æ”¶é›†å¿…è¦çš„ä¿¡æ¯ï¼ˆè®¢å•å·ã€é€€æ¬¾åŸå› ï¼‰
- å‘ŠçŸ¥å¤„ç†æµç¨‹å’Œæ—¶é—´
- è€ƒè™‘è½¬æ¥ä¸“é—¨çš„é€€æ¬¾ä¸“å‘˜"""
    }

    # å·¥å…·ä½¿ç”¨æç¤º
    TOOL_USAGE_PROMPTS = {
        "time_query": "ç”¨æˆ·è¯¢é—®æ—¶é—´ï¼Œè¯·ä½¿ç”¨ get_current_time å·¥å…·è·å–å‡†ç¡®æ—¶é—´ã€‚",
        "calculation": "ç”¨æˆ·éœ€è¦è®¡ç®—ï¼Œè¯·ä½¿ç”¨ calculate å·¥å…·æ‰§è¡Œæ•°å­¦è¿ç®—ã€‚æ³¨æ„ç¡®ä¿è¡¨è¾¾å¼å®‰å…¨ã€‚",
        "weather_query": "ç”¨æˆ·è¯¢é—®å¤©æ°”ï¼Œè¯·ä½¿ç”¨ get_weather å·¥å…·æŸ¥è¯¢æŒ‡å®šåŸå¸‚çš„å¤©æ°”ã€‚",
        "knowledge_search": "ç”¨æˆ·å¯»æ±‚ä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ search_knowledge_base å·¥å…·æœç´¢ç›¸å…³å†…å®¹ã€‚"
    }

    # å‡çº§åˆ°äººå·¥çš„æƒ…å†µ
    ESCALATION_TRIGGERS = {
        "sensitive_keywords": [
            "æŠ•è¯‰", "ä¸¾æŠ¥", "æ³•å¾‹", "å¾‹å¸ˆ", "èµ·è¯‰", "é€€æ¬¾", "èµ”å¿",
            "å·®è¯„", "ä¸æ»¡", "æ„¤æ€’", "å¤±æœ›", "æ¬ºéª—", "è™šå‡"
        ],
        "escalation_messages": [
            "æˆ‘ç†è§£æ‚¨çš„å…³åˆ‡ï¼Œä¸ºäº†ç»™æ‚¨æ›´å¥½çš„å¸®åŠ©ï¼Œæˆ‘å°†ä¸ºæ‚¨è½¬æ¥ä¸“ä¸šçš„äººå·¥å®¢æœã€‚",
            "è¿™ä¸ªé—®é¢˜éœ€è¦ä¸“ä¸šäººå‘˜å¤„ç†ï¼Œæˆ‘ç°åœ¨ä¸ºæ‚¨è½¬æ¥äººå·¥å®¢æœï¼Œè¯·ç¨ç­‰ã€‚",
            "ä¸ºäº†æ›´å¥½åœ°è§£å†³æ‚¨çš„é—®é¢˜ï¼Œæˆ‘å»ºè®®æ‚¨ä¸æˆ‘ä»¬çš„ä¸“ä¸šå®¢æœä»£è¡¨æ²Ÿé€šã€‚æ­£åœ¨ä¸ºæ‚¨è½¬æ¥ã€‚"
        ]
    }

    # é”™è¯¯å¤„ç†æç¤º
    ERROR_RESPONSES = {
        "api_error": [
            "æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›æŠ€æœ¯é—®é¢˜ã€‚è¯·ç¨åé‡è¯•ï¼Œæˆ–è€…æˆ‘å¯ä»¥ä¸ºæ‚¨è½¬æ¥äººå·¥å®¢æœã€‚",
            "ç³»ç»Ÿæš‚æ—¶ä¸å¯ç”¨ï¼Œç»™æ‚¨å¸¦æ¥ä¸ä¾¿æ·±æ„ŸæŠ±æ­‰ã€‚æ‚¨å¯ä»¥ç¨åå†è¯•æˆ–è”ç³»äººå·¥å®¢æœã€‚"
        ],
        "understanding_error": [
            "æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰å®Œå…¨ç†è§£æ‚¨çš„é—®é¢˜ã€‚èƒ½å¦è¯·æ‚¨æ¢ä¸ªæ–¹å¼æè¿°ä¸€ä¸‹ï¼Ÿ",
            "æˆ‘å¯èƒ½æ²¡æœ‰æ­£ç¡®ç†è§£æ‚¨çš„æ„æ€ï¼Œè¯·æ‚¨å†è¯¦ç»†è¯´æ˜ä¸€ä¸‹å¥½å—ï¼Ÿ"
        ],
        "capability_limit": [
            "è¿™ä¸ªé—®é¢˜è¶…å‡ºäº†æˆ‘çš„èƒ½åŠ›èŒƒå›´ï¼Œæˆ‘ä¸ºæ‚¨è½¬æ¥æ›´ä¸“ä¸šçš„äººå·¥å®¢æœã€‚",
            "è¿™ç§æƒ…å†µæˆ‘æ— æ³•ç‹¬ç«‹å¤„ç†ï¼Œè®©æˆ‘ä¸ºæ‚¨å®‰æ’ä¸“ä¸šçš„å®¢æœä»£è¡¨ã€‚"
        ]
    }

    @classmethod
    def get_system_prompt(cls, user_emotion: str = "neutral",
                         emotion_score: float = 0.5,
                         current_intent: str = "general",
                         confidence_score: float = 0.5,
                         memory_context: str = "æš‚æ— å†å²è®°å¿†") -> str:
        """è·å–ç³»ç»Ÿæç¤ºè¯"""
        return cls.SYSTEM_PROMPT.format(
            user_emotion=user_emotion,
            emotion_score=emotion_score,
            current_intent=current_intent,
            confidence_score=confidence_score,
            memory_context=memory_context
        )

    @classmethod
    def get_emotion_response(cls, emotion: str, emotion_score: float) -> str:
        """æ ¹æ®æƒ…æ„Ÿè·å–å›å¤"""
        import random

        if emotion_score <= 0.2:
            emotion_level = "very_negative"
        elif emotion_score <= 0.4:
            emotion_level = "negative"
        elif emotion_score <= 0.6:
            emotion_level = "neutral"
        elif emotion_score <= 0.8:
            emotion_level = "positive"
        else:
            emotion_level = "very_positive"

        responses = cls.EMOTION_RESPONSES.get(emotion_level, cls.EMOTION_RESPONSES["neutral"])
        return random.choice(responses)

    @classmethod
    def get_intent_prompt(cls, intent: str) -> str:
        """æ ¹æ®æ„å›¾è·å–ç‰¹å®šæç¤º"""
        return cls.INTENT_SPECIFIC_PROMPTS.get(intent, "")

    @classmethod
    def should_escalate(cls, text: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥å‡çº§åˆ°äººå·¥"""
        text_lower = text.lower()
        sensitive_keywords = cls.ESCALATION_TRIGGERS["sensitive_keywords"]
        return any(keyword in text_lower for keyword in sensitive_keywords)

    @classmethod
    def get_escalation_message(cls) -> str:
        """è·å–å‡çº§æ¶ˆæ¯"""
        import random
        messages = cls.ESCALATION_TRIGGERS["escalation_messages"]
        return random.choice(messages)

    @classmethod
    def get_error_response(cls, error_type: str) -> str:
        """è·å–é”™è¯¯å›å¤"""
        import random
        responses = cls.ERROR_RESPONSES.get(error_type, cls.ERROR_RESPONSES["api_error"])
        return random.choice(responses)


# ç‰¹æ®Šåœºæ™¯çš„å¯¹è¯æ¨¡æ¿
class ConversationTemplates:
    """å¯¹è¯æ¨¡æ¿"""

    # æ¬¢è¿æ–°ç”¨æˆ·
    WELCOME_NEW_USER = """æ‚¨å¥½ï¼æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„æ™ºèƒ½å®¢æœç³»ç»Ÿï¼ğŸ‘‹

æˆ‘æ˜¯æ‚¨çš„ä¸“å±å®¢æœåŠ©æ‰‹å°æ™ºï¼Œæˆ‘å¯ä»¥å¸®åŠ©æ‚¨ï¼š
â€¢ ğŸ“¦ æŸ¥è¯¢è®¢å•çŠ¶æ€å’Œç‰©æµä¿¡æ¯
â€¢ ğŸ› ï¸ è§£å†³æŠ€æœ¯é—®é¢˜å’Œä½¿ç”¨å›°æƒ‘
â€¢ â° æä¾›æ—¶é—´ã€å¤©æ°”ç­‰ç”Ÿæ´»ä¿¡æ¯
â€¢ ğŸ§® è¿›è¡Œå„ç§è®¡ç®—å’Œæ•°æ®å¤„ç†
â€¢ ğŸ“š æœç´¢äº§å“ä¿¡æ¯å’ŒæœåŠ¡è¯¦æƒ…

è¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Œæˆ‘ä¼šå°½æˆ‘æ‰€èƒ½ä¸ºæ‚¨æœåŠ¡ï¼"""

    # ä¼šè¯æ€»ç»“
    CONVERSATION_SUMMARY = """æ„Ÿè°¢æ‚¨ä»Šå¤©çš„å’¨è¯¢ï¼ğŸ“‹

æœ¬æ¬¡ä¼šè¯æ‘˜è¦ï¼š
â€¢ å¯¹è¯è½®æ¬¡ï¼š{turn_count}
â€¢ ä¸»è¦é—®é¢˜ï¼š{main_topics}
â€¢ ä½¿ç”¨å·¥å…·ï¼š{tools_used}
â€¢ è§£å†³çŠ¶æ€ï¼š{resolution_status}

å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œéšæ—¶å¯ä»¥è”ç³»æˆ‘ä»¬ã€‚ç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼âœ¨"""

    # æ»¡æ„åº¦è°ƒæŸ¥
    SATISFACTION_SURVEY = """ä¸ºäº†æå‡æœåŠ¡è´¨é‡ï¼Œå¸Œæœ›æ‚¨èƒ½èŠ±ä¸€åˆ†é’Ÿè¿›è¡Œæ»¡æ„åº¦è¯„ä»·ï¼š

â­ å¯¹æœ¬æ¬¡æœåŠ¡æ‚¨çš„æ»¡æ„åº¦å¦‚ä½•ï¼Ÿï¼ˆ1-5åˆ†ï¼‰
ğŸ’¬ æœ‰ä»€ä¹ˆå»ºè®®æˆ–æ„è§å—ï¼Ÿ

æ‚¨çš„åé¦ˆå¯¹æˆ‘ä»¬éå¸¸é‡è¦ï¼"""


# å¤šè¯­è¨€æ”¯æŒï¼ˆåŸºç¡€ï¼‰
class MultiLanguagePrompts:
    """å¤šè¯­è¨€æç¤ºè¯"""

    LANGUAGES = {
        "zh": {
            "greeting": "æ‚¨å¥½ï¼æˆ‘æ˜¯æ™ºèƒ½å®¢æœå°æ™ºï¼Œå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼",
            "goodbye": "æ„Ÿè°¢æ‚¨çš„å’¨è¯¢ï¼Œç¥æ‚¨ç”Ÿæ´»æ„‰å¿«ï¼",
            "error": "æŠ±æ­‰ï¼Œç³»ç»Ÿé‡åˆ°äº†é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•ã€‚",
            "escalation": "æˆ‘å°†ä¸ºæ‚¨è½¬æ¥äººå·¥å®¢æœï¼Œè¯·ç¨ç­‰ã€‚"
        },
        "en": {
            "greeting": "Hello! I'm AI assistant XiaoZhi, happy to help you!",
            "goodbye": "Thank you for your inquiry, have a great day!",
            "error": "Sorry, the system encountered an issue, please try again later.",
            "escalation": "I'll transfer you to a human agent, please wait."
        }
    }

    @classmethod
    def get_message(cls, language: str, key: str) -> str:
        """è·å–æŒ‡å®šè¯­è¨€çš„æ¶ˆæ¯"""
        return cls.LANGUAGES.get(language, cls.LANGUAGES["zh"]).get(key, "")


if __name__ == "__main__":
    # ç¤ºä¾‹ä½¿ç”¨
    print("=== æç¤ºè¯æ¨¡æ¿ç¤ºä¾‹ ===")

    # ç³»ç»Ÿæç¤ºè¯
    prompt = PromptTemplates.get_system_prompt(
        user_emotion="positive",
        emotion_score=0.8,
        current_intent="greeting",
        confidence_score=0.9
    )
    print("ç³»ç»Ÿæç¤ºè¯:")
    print(prompt[:200] + "...")

    # æƒ…æ„Ÿå›å¤
    emotion_response = PromptTemplates.get_emotion_response("positive", 0.8)
    print(f"\næƒ…æ„Ÿå›å¤: {emotion_response}")

    # å‡çº§åˆ¤æ–­
    should_escalate = PromptTemplates.should_escalate("æˆ‘è¦æŠ•è¯‰è¿™ä¸ªäº§å“")
    print(f"\næ˜¯å¦éœ€è¦å‡çº§: {should_escalate}")

    print("\nâœ… æç¤ºè¯é…ç½®æ¨¡å—æµ‹è¯•å®Œæˆï¼")