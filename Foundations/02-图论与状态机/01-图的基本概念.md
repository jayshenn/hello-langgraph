# å›¾çš„åŸºæœ¬æ¦‚å¿µ

> ğŸ¯ **å­¦ä¹ ç›®æ ‡**ï¼šç†è§£å›¾çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸ºæŒæ¡ LangGraph çš„å·¥ä½œåŸç†æ‰“ä¸‹æ•°å­¦åŸºç¡€

## ğŸ¤” ä¸ºä»€ä¹ˆè¦å­¦ä¹ å›¾è®ºï¼Ÿ

LangGraph çš„åå­—å°±è¯´æ˜äº†ä¸€åˆ‡ - å®ƒæ˜¯åŸºäº**å›¾**çš„ç»“æ„æ¥ç»„ç»‡ AI Agent çš„å·¥ä½œæµã€‚ç†è§£å›¾çš„æ¦‚å¿µï¼Œå°±èƒ½æ›´å¥½åœ°è®¾è®¡å’Œè°ƒè¯•ä½ çš„ Agent ç³»ç»Ÿã€‚

## ğŸ”µ å›¾æ˜¯ä»€ä¹ˆï¼Ÿ

### ç”Ÿæ´»ä¸­çš„å›¾

åœ¨å­¦ä¹ æŠ½è±¡æ¦‚å¿µä¹‹å‰ï¼Œè®©æˆ‘ä»¬ä»ç”Ÿæ´»ä¸­çš„ä¾‹å­å¼€å§‹ï¼š

```
åœ°é“çº¿è·¯å›¾:
    åŒ—äº¬ç«™ â€”â€”â€” å»ºå›½é—¨ â€”â€”â€” æœé˜³é—¨
       |         |         |
    å¤©å®‰é—¨ä¸œ â€”â€”â€” ç‹åºœäº• â€”â€”â€” ä¸œå››
```

è¿™å°±æ˜¯ä¸€ä¸ªå›¾ï¼å…¶ä¸­ï¼š
- **èŠ‚ç‚¹**ï¼ˆNodeï¼‰ï¼šå„ä¸ªåœ°é“ç«™
- **è¾¹**ï¼ˆEdgeï¼‰ï¼šè¿æ¥ç«™ç‚¹çš„åœ°é“çº¿è·¯

### ç¨‹åºä¸­çš„å›¾

```python
# ç”¨å­—å…¸è¡¨ç¤ºåœ°é“å›¾
subway_graph = {
    "åŒ—äº¬ç«™": ["å»ºå›½é—¨", "å¤©å®‰é—¨ä¸œ"],
    "å»ºå›½é—¨": ["åŒ—äº¬ç«™", "æœé˜³é—¨", "ç‹åºœäº•"],
    "æœé˜³é—¨": ["å»ºå›½é—¨", "ä¸œå››"],
    "å¤©å®‰é—¨ä¸œ": ["åŒ—äº¬ç«™", "ç‹åºœäº•"],
    "ç‹åºœäº•": ["å»ºå›½é—¨", "å¤©å®‰é—¨ä¸œ", "ä¸œå››"],
    "ä¸œå››": ["æœé˜³é—¨", "ç‹åºœäº•"]
}
```

## ğŸ¯ å›¾çš„åŸºæœ¬å…ƒç´ 

### 1. èŠ‚ç‚¹ï¼ˆNode/Vertexï¼‰

```python
# åœ¨ LangGraph ä¸­ï¼ŒèŠ‚ç‚¹é€šå¸¸æ˜¯å‡½æ•°
def greeting_node(state):
    """é—®å€™èŠ‚ç‚¹ - å¤„ç†ç”¨æˆ·çš„é—®å€™"""
    return {"message": "ä½ å¥½ï¼æˆ‘æ˜¯ AI åŠ©æ‰‹"}

def search_node(state):
    """æœç´¢èŠ‚ç‚¹ - æ‰§è¡Œç½‘ç»œæœç´¢"""
    query = state["message"]
    return {"search_results": f"æœç´¢'{query}'çš„ç»“æœ..."}
```

### 2. è¾¹ï¼ˆEdgeï¼‰

è¾¹å®šä¹‰äº†ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹çš„è¿æ¥ï¼š

```python
# ç®€å•çš„è¿æ¥ï¼šé—®å€™ â†’ æœç´¢
graph.add_edge("greeting_node", "search_node")

# æ¡ä»¶è¿æ¥ï¼šæ ¹æ®çŠ¶æ€å†³å®šä¸‹ä¸€æ­¥
def should_search(state):
    """å†³å®šæ˜¯å¦éœ€è¦æœç´¢"""
    if "æœç´¢" in state["message"]:
        return "search_node"
    else:
        return "chat_node"

graph.add_conditional_edges("greeting_node", should_search)
```

## ğŸ”„ å›¾çš„ç±»å‹

### 1. æ— å‘å›¾ vs æœ‰å‘å›¾

```
æ— å‘å›¾ï¼ˆæœ‹å‹å…³ç³»ï¼‰:
Alice â€”â€”â€” Bob
  |        |
Carol â€”â€”â€” David

æœ‰å‘å›¾ï¼ˆå…³æ³¨å…³ç³»ï¼‰:
Alice â€”â€”â†’ Bob
  â†‘        â†“
Carol â†â€”â€” David
```

**LangGraph ä½¿ç”¨æœ‰å‘å›¾**ï¼Œå› ä¸º Agent çš„å·¥ä½œæµæœ‰æ˜ç¡®çš„æ–¹å‘ã€‚

### 2. å¾ªç¯å›¾ vs æ— ç¯å›¾

```
æ— ç¯å›¾ï¼ˆç€‘å¸ƒæµç¨‹ï¼‰:
å¼€å§‹ â†’ å¤„ç† â†’ ç»“æŸ

å¾ªç¯å›¾ï¼ˆè¿­ä»£æµç¨‹ï¼‰:
å¼€å§‹ â†’ å¤„ç† â†’ æ£€æŸ¥
  â†‘              â†“
ç»“æŸ â†â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ç»§ç»­ï¼Ÿ
```

**LangGraph æ”¯æŒå¾ªç¯**ï¼Œè¿™è®© Agent å¯ä»¥è¿›è¡Œè¿­ä»£æ€è€ƒã€‚

## ğŸš€ LangGraph ä¸­çš„å›¾ç¤ºä¾‹

### ç®€å•çº¿æ€§å›¾

```python
from langgraph.graph import StateGraph
from typing import TypedDict

class SimpleState(TypedDict):
    message: str
    step: int

# ä¸‰ä¸ªè¿ç»­çš„èŠ‚ç‚¹
def step1(state: SimpleState) -> SimpleState:
    return {
        "message": f"æ­¥éª¤1: {state['message']}",
        "step": 1
    }

def step2(state: SimpleState) -> SimpleState:
    return {
        "message": f"æ­¥éª¤2: {state['message']}",
        "step": 2
    }

def step3(state: SimpleState) -> SimpleState:
    return {
        "message": f"æ­¥éª¤3: {state['message']}",
        "step": 3
    }

# æ„å»ºå›¾
graph = StateGraph(SimpleState)
graph.add_node("step1", step1)
graph.add_node("step2", step2)
graph.add_node("step3", step3)

# è¿æ¥èŠ‚ç‚¹ï¼ˆçº¿æ€§ï¼‰
graph.set_entry_point("step1")
graph.add_edge("step1", "step2")
graph.add_edge("step2", "step3")
graph.set_finish_point("step3")

app = graph.compile()
```

### åˆ†æ”¯å›¾

```python
class BranchState(TypedDict):
    user_input: str
    intent: str
    response: str

def analyze_intent(state: BranchState) -> BranchState:
    """åˆ†æç”¨æˆ·æ„å›¾"""
    user_input = state["user_input"].lower()

    if "å¤©æ°”" in user_input:
        intent = "weather"
    elif "æ—¶é—´" in user_input:
        intent = "time"
    else:
        intent = "chat"

    return {**state, "intent": intent}

def weather_node(state: BranchState) -> BranchState:
    """å¤„ç†å¤©æ°”æŸ¥è¯¢"""
    return {**state, "response": "ä»Šå¤©å¤©æ°”æ™´æœ—"}

def time_node(state: BranchState) -> BranchState:
    """å¤„ç†æ—¶é—´æŸ¥è¯¢"""
    return {**state, "response": "ç°åœ¨æ˜¯ä¸‹åˆ2ç‚¹"}

def chat_node(state: BranchState) -> BranchState:
    """ä¸€èˆ¬èŠå¤©"""
    return {**state, "response": "æˆ‘ä»¬èŠèŠå§ï¼"}

# æ¡ä»¶è·¯ç”±å‡½æ•°
def route_by_intent(state: BranchState) -> str:
    """æ ¹æ®æ„å›¾è·¯ç”±åˆ°ä¸åŒèŠ‚ç‚¹"""
    intent_mapping = {
        "weather": "weather_node",
        "time": "time_node",
        "chat": "chat_node"
    }
    return intent_mapping.get(state["intent"], "chat_node")

# æ„å»ºåˆ†æ”¯å›¾
graph = StateGraph(BranchState)
graph.add_node("analyze", analyze_intent)
graph.add_node("weather_node", weather_node)
graph.add_node("time_node", time_node)
graph.add_node("chat_node", chat_node)

graph.set_entry_point("analyze")
graph.add_conditional_edges(
    "analyze",
    route_by_intent,
    {
        "weather_node": "weather_node",
        "time_node": "time_node",
        "chat_node": "chat_node"
    }
)

# æ‰€æœ‰åˆ†æ”¯éƒ½ç»“æŸ
from langgraph.graph import END
graph.add_edge("weather_node", END)
graph.add_edge("time_node", END)
graph.add_edge("chat_node", END)

app = graph.compile()
```

## ğŸ” å›¾çš„éå†

### æ·±åº¦ä¼˜å…ˆ vs å¹¿åº¦ä¼˜å…ˆ

è™½ç„¶ LangGraph æœ‰è‡ªå·±çš„æ‰§è¡Œç­–ç•¥ï¼Œä½†ç†è§£å›¾éå†æœ‰åŠ©äºè°ƒè¯•ï¼š

```python
def visualize_graph_execution(graph_state_history):
    """å¯è§†åŒ–å›¾çš„æ‰§è¡Œè·¯å¾„"""
    print("å›¾æ‰§è¡Œè·¯å¾„:")
    for i, (node_name, state) in enumerate(graph_state_history):
        print(f"  {i+1}. {node_name}: {state}")

# ç¤ºä¾‹è¾“å‡º:
# å›¾æ‰§è¡Œè·¯å¾„:
#   1. analyze: {"user_input": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·", "intent": "weather"}
#   2. weather_node: {"user_input": "ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·", "intent": "weather", "response": "ä»Šå¤©å¤©æ°”æ™´æœ—"}
```

## ğŸª å®è·µç»ƒä¹ 

### ç»ƒä¹  1ï¼šè®¾è®¡ç®€å•å›¾

è®¾è®¡ä¸€ä¸ªå’–å•¡è®¢è´­æµç¨‹çš„å›¾ï¼š

```
å¼€å§‹ â†’ é€‰æ‹©å’–å•¡ â†’ é€‰æ‹©å¤§å° â†’ ç¡®è®¤è®¢å• â†’ ç»“æŸ
```

<details>
<summary>ğŸ” æŸ¥çœ‹ç­”æ¡ˆ</summary>

```python
from typing import TypedDict

class CoffeeOrderState(TypedDict):
    coffee_type: str
    size: str
    confirmed: bool
    total_price: float

def select_coffee(state: CoffeeOrderState) -> CoffeeOrderState:
    return {**state, "coffee_type": "æ‹¿é“"}

def select_size(state: CoffeeOrderState) -> CoffeeOrderState:
    return {**state, "size": "ä¸­æ¯"}

def confirm_order(state: CoffeeOrderState) -> CoffeeOrderState:
    price = 25.0 if state["size"] == "ä¸­æ¯" else 30.0
    return {**state, "confirmed": True, "total_price": price}

# æ„å»ºå›¾
graph = StateGraph(CoffeeOrderState)
graph.add_node("select_coffee", select_coffee)
graph.add_node("select_size", select_size)
graph.add_node("confirm", confirm_order)

graph.set_entry_point("select_coffee")
graph.add_edge("select_coffee", "select_size")
graph.add_edge("select_size", "confirm")
graph.set_finish_point("confirm")
```
</details>

### ç»ƒä¹  2ï¼šå¸¦æ¡ä»¶çš„å›¾

è®¾è®¡ä¸€ä¸ªATMå–æ¬¾æµç¨‹ï¼ŒåŒ…å«ä½™é¢æ£€æŸ¥ï¼š

```
éªŒè¯å¯†ç  â†’ æ£€æŸ¥ä½™é¢ â†’ [è¶³å¤Ÿ] â†’ å–æ¬¾ â†’ ç»“æŸ
                   â†’ [ä¸è¶³] â†’ æç¤º â†’ ç»“æŸ
```

## ğŸ”§ å›¾çš„å¯è§†åŒ–

ç†è§£å›¾ç»“æ„çš„æœ€å¥½æ–¹æ³•æ˜¯å¯è§†åŒ–ï¼š

```python
# LangGraph å†…ç½®å¯è§†åŒ–ï¼ˆéœ€è¦å®‰è£…é¢å¤–ä¾èµ–ï¼‰
try:
    from IPython.display import Image, display
    display(Image(app.get_graph().draw_mermaid_png()))
except ImportError:
    print("å®‰è£… jupyter å’Œ langsmith ä»¥ä½¿ç”¨å¯è§†åŒ–åŠŸèƒ½")

# ç®€å•çš„æ–‡æœ¬å¯è§†åŒ–
def print_graph_structure(graph):
    """æ‰“å°å›¾çš„ç»“æ„"""
    print("å›¾ç»“æ„:")
    for node_name in graph.nodes:
        print(f"  èŠ‚ç‚¹: {node_name}")

    print("  è¿æ¥:")
    for source, target in graph.edges:
        print(f"    {source} â†’ {target}")
```

## ğŸ’¡ å…³é”®æ¦‚å¿µæ€»ç»“

1. **å›¾ = èŠ‚ç‚¹ + è¾¹**ï¼šèŠ‚ç‚¹æ˜¯å¤„ç†é€»è¾‘ï¼Œè¾¹æ˜¯æµç¨‹æ§åˆ¶
2. **æœ‰å‘å›¾**ï¼šLangGraph ä¸­çš„æ•°æ®æµæœ‰æ˜ç¡®æ–¹å‘
3. **çŠ¶æ€ä¼ é€’**ï¼šé€šè¿‡è¾¹åœ¨èŠ‚ç‚¹é—´ä¼ é€’çŠ¶æ€
4. **æ¡ä»¶è·¯ç”±**ï¼šæ ¹æ®çŠ¶æ€å†…å®¹å†³å®šä¸‹ä¸€æ­¥
5. **å¾ªç¯æ”¯æŒ**ï¼šå…è®¸è¿­ä»£å’Œé‡è¯•é€»è¾‘

## ğŸš€ ä¸‹ä¸€æ­¥

ç†è§£äº†å›¾çš„åŸºæœ¬æ¦‚å¿µåï¼Œæ¥ä¸‹æ¥å­¦ä¹ ï¼š
- `02-çŠ¶æ€æœºåŸç†.md` - æ·±å…¥ç†è§£çŠ¶æ€è½¬æ¢
- `03-å·¥ä½œæµæ¨¡å¼.md` - å¸¸è§çš„å›¾è®¾è®¡æ¨¡å¼

---

*ç°åœ¨ä½ å·²ç»æŒæ¡äº†å›¾çš„åŸºæœ¬æ¦‚å¿µï¼Œè¿™æ˜¯ç†è§£ LangGraph æ¶æ„çš„é‡è¦åŸºç¡€ï¼* ğŸ‰