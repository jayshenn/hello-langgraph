# Python ç±»å‹ç³»ç»ŸåŸºç¡€

> ğŸ¯ **å­¦ä¹ ç›®æ ‡**ï¼šç†è§£ Python ç±»å‹æ³¨è§£çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸ºå­¦ä¹  LangGraph çš„ AgentState æ‰“ä¸‹åŸºç¡€

## ğŸ“– ä¸ºä»€ä¹ˆéœ€è¦ç±»å‹æ³¨è§£ï¼Ÿ

åœ¨ LangGraph ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ°è¿™æ ·çš„ä»£ç ï¼š

```python
from typing import TypedDict

class AgentState(TypedDict):
    message: str
    count: int
```

è¿™é‡Œçš„ `str` å’Œ `int` å°±æ˜¯**ç±»å‹æ³¨è§£**ã€‚è®©æˆ‘ä»¬ä»æœ€åŸºç¡€çš„æ¦‚å¿µå¼€å§‹ç†è§£ã€‚

## ğŸ”¤ åŸºç¡€ç±»å‹æ³¨è§£

### ç®€å•ç±»å‹

```python
# åŸºç¡€æ•°æ®ç±»å‹
name: str = "Alice"
age: int = 25
height: float = 1.75
is_student: bool = True

# å‡½æ•°ç±»å‹æ³¨è§£
def greet(name: str) -> str:
    return f"Hello, {name}!"

# è°ƒç”¨å‡½æ•°
message = greet("Bob")  # message çš„ç±»å‹æ˜¯ str
```

### å®¹å™¨ç±»å‹

```python
from typing import List, Dict, Optional

# åˆ—è¡¨ç±»å‹
names: List[str] = ["Alice", "Bob", "Charlie"]
scores: List[int] = [85, 92, 78]

# å­—å…¸ç±»å‹
student_grades: Dict[str, int] = {
    "Alice": 85,
    "Bob": 92,
    "Charlie": 78
}

# å¯é€‰ç±»å‹ï¼ˆå¯èƒ½æ˜¯ Noneï¼‰
middle_name: Optional[str] = None  # ç›¸å½“äº Union[str, None]
```

## ğŸ¯ ä¸ºä»€ä¹ˆ LangGraph åçˆ±ç±»å‹æ³¨è§£ï¼Ÿ

### 1. ä»£ç å¯è¯»æ€§

**æ²¡æœ‰ç±»å‹æ³¨è§£çš„ä»£ç ï¼š**
```python
def process_user_input(data):
    # ğŸ˜• ä¸çŸ¥é“ data æ˜¯ä»€ä¹ˆç±»å‹
    # ä¸çŸ¥é“è¿”å›ä»€ä¹ˆç±»å‹
    result = data["message"] + " processed"
    return {"response": result, "count": len(result)}
```

**æœ‰ç±»å‹æ³¨è§£çš„ä»£ç ï¼š**
```python
from typing import Dict

def process_user_input(data: Dict[str, str]) -> Dict[str, any]:
    # âœ… æ¸…æ¥šçŸ¥é“ data æ˜¯å­—ç¬¦ä¸²å­—å…¸
    # âœ… æ¸…æ¥šçŸ¥é“è¿”å›å­—å…¸ç±»å‹
    result = data["message"] + " processed"
    return {"response": result, "count": len(result)}
```

### 2. é”™è¯¯é¢„é˜²

```python
# é”™è¯¯çš„è°ƒç”¨
age = "25"  # å­—ç¬¦ä¸²è€Œä¸æ˜¯æ•°å­—
# process_age(age)  # ç±»å‹æ£€æŸ¥å™¨ä¼šè­¦å‘Šè¿™é‡Œæœ‰é—®é¢˜

def process_age(age: int) -> str:
    if age >= 18:
        return "æˆå¹´äºº"
    else:
        return "æœªæˆå¹´äºº"
```

## ğŸ” Union ç±»å‹ï¼šå¤šç§å¯èƒ½æ€§

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ•°æ®å¯èƒ½æœ‰å¤šç§ç±»å‹ï¼š

```python
from typing import Union

# ç”¨æˆ·è¾“å…¥å¯èƒ½æ˜¯å­—ç¬¦ä¸²æˆ–æ•°å­—
def process_input(value: Union[str, int]) -> str:
    if isinstance(value, str):
        return f"å¤„ç†å­—ç¬¦ä¸²: {value}"
    elif isinstance(value, int):
        return f"å¤„ç†æ•°å­—: {value}"

# ä½¿ç”¨ç¤ºä¾‹
result1 = process_input("hello")     # âœ… å­—ç¬¦ä¸²
result2 = process_input(42)          # âœ… æ•°å­—
# result3 = process_input([1, 2, 3])  # âŒ åˆ—è¡¨ä¸è¢«æ¥å—
```

## ğŸª å®é™…ç»ƒä¹ ï¼šæ¨¡æ‹Ÿ LangGraph åœºæ™¯

è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£ï¼š

```python
from typing import Dict, List, Optional

# æ¨¡æ‹ŸèŠå¤©æœºå™¨äººçš„æ¶ˆæ¯ç±»å‹
def process_chat_message(
    message: str,
    user_id: int,
    conversation_history: List[str],
    metadata: Optional[Dict[str, str]] = None
) -> Dict[str, any]:
    """
    å¤„ç†èŠå¤©æ¶ˆæ¯

    å‚æ•°:
        message: ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯
        user_id: ç”¨æˆ·ID
        conversation_history: å¯¹è¯å†å²
        metadata: å¯é€‰çš„å…ƒæ•°æ®

    è¿”å›:
        åŒ…å«å“åº”å’Œæ›´æ–°åå†å²çš„å­—å…¸
    """
    # æ·»åŠ æ–°æ¶ˆæ¯åˆ°å†å²
    updated_history = conversation_history + [f"ç”¨æˆ·{user_id}: {message}"]

    # ç”Ÿæˆå“åº”
    response = f"æˆ‘æ”¶åˆ°äº†ä½ çš„æ¶ˆæ¯: {message}"
    updated_history.append(f"æœºå™¨äºº: {response}")

    # æ„é€ è¿”å›ç»“æœ
    result = {
        "response": response,
        "conversation_history": updated_history,
        "message_count": len(updated_history)
    }

    # å¦‚æœæœ‰å…ƒæ•°æ®ï¼Œæ·»åŠ åˆ°ç»“æœä¸­
    if metadata:
        result["metadata"] = metadata

    return result

# ä½¿ç”¨ç¤ºä¾‹
history = ["ç”¨æˆ·1: ä½ å¥½", "æœºå™¨äºº: ä½ å¥½ï¼å¾ˆé«˜å…´è§åˆ°ä½ "]
metadata = {"timestamp": "2024-01-01", "channel": "web"}

result = process_chat_message(
    message="ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ",
    user_id=1,
    conversation_history=history,
    metadata=metadata
)

print(result)
```

## ğŸ”§ ç±»å‹æ£€æŸ¥å·¥å…·

### ä½¿ç”¨ mypy æ£€æŸ¥ç±»å‹

```bash
# å®‰è£… mypy
pip install mypy

# æ£€æŸ¥ Python æ–‡ä»¶
mypy your_file.py
```

### åœ¨ IDE ä¸­çš„ä¼˜åŠ¿

ç°ä»£ IDEï¼ˆå¦‚ VS Codeã€PyCharmï¼‰ä¼šåˆ©ç”¨ç±»å‹æ³¨è§£ï¼š
- æä¾›æ›´å¥½çš„ä»£ç è¡¥å…¨
- å®æ—¶æ˜¾ç¤ºç±»å‹é”™è¯¯
- é‡æ„æ—¶æ›´å®‰å…¨

## âœ… è‡ªæµ‹ç»ƒä¹ 

å®Œæˆä»¥ä¸‹ç»ƒä¹ æ¥æµ‹è¯•ä½ çš„ç†è§£ï¼š

### ç»ƒä¹  1ï¼šåŸºç¡€æ³¨è§£

ä¸ºä»¥ä¸‹å‡½æ•°æ·»åŠ ç±»å‹æ³¨è§£ï¼š

```python
# TODO: æ·»åŠ ç±»å‹æ³¨è§£
def calculate_average(numbers):
    return sum(numbers) / len(numbers)

def format_user_info(name, age, email):
    return f"å§“å: {name}, å¹´é¾„: {age}, é‚®ç®±: {email}"
```

<details>
<summary>ğŸ” æŸ¥çœ‹ç­”æ¡ˆ</summary>

```python
from typing import List

def calculate_average(numbers: List[float]) -> float:
    return sum(numbers) / len(numbers)

def format_user_info(name: str, age: int, email: str) -> str:
    return f"å§“å: {name}, å¹´é¾„: {age}, é‚®ç®±: {email}"
```
</details>

### ç»ƒä¹  2ï¼šå¤æ‚ç±»å‹

åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥å¤„ç†å­¦ç”Ÿä¿¡æ¯ï¼š

```python
# TODO: æ·»åŠ å®Œæ•´çš„ç±»å‹æ³¨è§£
def process_student_data(student_data):
    """
    student_data æ ¼å¼:
    {
        "name": "å¼ ä¸‰",
        "grades": [85, 92, 78],
        "extra_info": {"class": "Aç­", "teacher": "æè€å¸ˆ"}  # å¯é€‰
    }
    """
    # è®¡ç®—å¹³å‡åˆ†
    avg_grade = sum(student_data["grades"]) / len(student_data["grades"])

    result = {
        "name": student_data["name"],
        "average_grade": avg_grade,
        "grade_count": len(student_data["grades"])
    }

    if "extra_info" in student_data:
        result["extra_info"] = student_data["extra_info"]

    return result
```

<details>
<summary>ğŸ” æŸ¥çœ‹ç­”æ¡ˆ</summary>

```python
from typing import Dict, List, Optional, Union

def process_student_data(
    student_data: Dict[str, Union[str, List[int], Dict[str, str]]]
) -> Dict[str, Union[str, float, int, Dict[str, str]]]:
    # æˆ–è€…æ›´ç²¾ç¡®çš„ç‰ˆæœ¬ï¼š
    """
    student_data: Dict åŒ…å«:
        - "name": str
        - "grades": List[int]
        - "extra_info": Optional[Dict[str, str]]
    """
    avg_grade = sum(student_data["grades"]) / len(student_data["grades"])

    result = {
        "name": student_data["name"],
        "average_grade": avg_grade,
        "grade_count": len(student_data["grades"])
    }

    if "extra_info" in student_data:
        result["extra_info"] = student_data["extra_info"]

    return result
```
</details>

## ğŸš€ ä¸‹ä¸€æ­¥

æŒæ¡äº†åŸºç¡€ç±»å‹æ³¨è§£åï¼Œæ¥ä¸‹æ¥å­¦ä¹ ï¼š
- `02-TypedDictæ·±å…¥.md` - LangGraph çŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒ
- `03-å¼‚æ­¥ç¼–ç¨‹åŸºç¡€.md` - ç°ä»£ Python åº”ç”¨çš„å¿…å¤‡æŠ€èƒ½

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **ç±»å‹æ³¨è§£æå‡ä»£ç å¯è¯»æ€§**ï¼šè®©ä»£ç æ„å›¾æ›´æ¸…æ™°
2. **é”™è¯¯é¢„é˜²**ï¼šåœ¨è¿è¡Œå‰å‘ç°æ½œåœ¨é—®é¢˜
3. **IDE æ”¯æŒ**ï¼šæ›´å¥½çš„ä»£ç è¡¥å…¨å’Œé‡æ„
4. **LangGraph åŸºç¡€**ï¼šç†è§£ AgentState è®¾è®¡çš„å‰æ

---

*ç°åœ¨ä½ å·²ç»æŒæ¡äº† Python ç±»å‹ç³»ç»Ÿçš„åŸºç¡€ï¼è¿™äº›çŸ¥è¯†å°†åœ¨å­¦ä¹  LangGraph æ—¶æ´¾ä¸Šå¤§ç”¨åœºã€‚* ğŸ‰