# 02-äº‘éƒ¨ç½²

## æ¦‚è¿°

LangGraph Cloud SaaS æ˜¯å®˜æ–¹æä¾›çš„æ‰˜ç®¡æœåŠ¡ï¼Œæä¾›é›¶è¿ç»´çš„ç”Ÿäº§çº§éƒ¨ç½²ç¯å¢ƒã€‚é€šè¿‡ GitHub é›†æˆå®ç°è‡ªåŠ¨åŒ– CI/CDï¼Œæ”¯æŒå¤šç¯å¢ƒç®¡ç†ã€è‡ªåŠ¨æ‰©å±•å’Œå†…ç½®ç›‘æ§ã€‚

## Cloud SaaS æ¶æ„

### æ§åˆ¶å¹³é¢ (Control Plane)
- **Web UI**: é¡¹ç›®ç®¡ç†ã€éƒ¨ç½²é…ç½®
- **API**: ç¨‹åºåŒ–ç®¡ç†æ¥å£
- **GitHub é›†æˆ**: è‡ªåŠ¨éƒ¨ç½²æµæ°´çº¿
- **ç¯å¢ƒç®¡ç†**: å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ

### æ•°æ®å¹³é¢ (Data Plane)
- **LangGraph æœåŠ¡å™¨**: æ‰§è¡Œ Agent åº”ç”¨
- **ä»»åŠ¡é˜Ÿåˆ—**: å¼‚æ­¥ä½œä¸šå¤„ç†
- **æŒä¹…åŒ–å­˜å‚¨**: çŠ¶æ€å’Œæ£€æŸ¥ç‚¹
- **ç›‘æ§ç³»ç»Ÿ**: æ€§èƒ½æŒ‡æ ‡å’Œæ—¥å¿—

### æœåŠ¡ç‰¹æ€§
- âœ… é›¶åŸºç¡€è®¾æ–½ç®¡ç†
- âœ… è‡ªåŠ¨æ‰©å±•å’Œè´Ÿè½½å‡è¡¡
- âœ… å†…ç½®ç›‘æ§å’Œæ—¥å¿—
- âœ… å¤šåŒºåŸŸéƒ¨ç½²
- âœ… ä¼ä¸šçº§å®‰å…¨
- âœ… SLA ä¿è¯

## éƒ¨ç½²å‡†å¤‡

### 1. è´¦å·è®¾ç½®
```bash
# è®¿é—® LangGraph Platform
# https://langchain-ai.github.io/langgraph/cloud/

# ä½¿ç”¨ GitHub è´¦å·ç™»å½•
# æˆ–æ³¨å†Œæ–°çš„ LangSmith è´¦å·
```

### 2. GitHub ä»“åº“å‡†å¤‡
```bash
# ç¡®ä¿ä»£ç å·²æ¨é€åˆ° GitHub
git init
git add .
git commit -m "Initial commit"
git remote add origin https://github.com/username/my-agent.git
git push -u origin main
```

### 3. é¡¹ç›®ç»“æ„è¦æ±‚
```
my-agent/
â”œâ”€â”€ langgraph.json          # å¿…éœ€ï¼šé¡¹ç›®é…ç½®
â”œâ”€â”€ requirements.txt        # æˆ– pyproject.toml
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ src/
â”‚   â””â”€â”€ my_agent/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ graph.py       # å›¾å®šä¹‰
â”‚       â””â”€â”€ state.py       # çŠ¶æ€å®šä¹‰
â””â”€â”€ README.md              # é¡¹ç›®è¯´æ˜
```

## é…ç½®æ–‡ä»¶

### langgraph.json
```json
{
  "dependencies": ["."],
  "graphs": {
    "my_agent": "./src/my_agent/graph.py:graph"
  },
  "env": ".env",
  "python_version": "3.11",
  "pip_config_file": "pyproject.toml",
  "dockerfile_lines": [
    "RUN apt-get update && apt-get install -y curl",
    "RUN pip install --upgrade pip"
  ]
}
```

**æ ¸å¿ƒé…ç½®è¯´æ˜ï¼š**
- `dependencies`: åŒ…ä¾èµ–è·¯å¾„
- `graphs`: å›¾å®šä¹‰æ˜ å°„å…³ç³»
- `env`: ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶
- `python_version`: è¿è¡Œæ—¶ Python ç‰ˆæœ¬
- `dockerfile_lines`: è‡ªå®šä¹‰æ„å»ºæŒ‡ä»¤

### requirements.txt
```txt
langgraph>=0.2.0
langchain>=0.3.0
langchain_openai>=0.2.0
langchain_community>=0.3.0
python-dotenv>=1.0.0
pydantic>=2.0.0
requests>=2.31.0
aiohttp>=3.9.0
```

### pyproject.toml (å¯é€‰)
```toml
[build-system]
requires = ["setuptools>=61.0", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "my-agent"
version = "0.1.0"
description = "My LangGraph Agent"
dependencies = [
    "langgraph>=0.2.0",
    "langchain>=0.3.0",
    "langchain_openai>=0.2.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=7.0.0",
    "black>=23.0.0",
    "isort>=5.12.0",
]
```

## éƒ¨ç½²æµç¨‹

### 1. åˆ›å»ºéƒ¨ç½²

#### é€šè¿‡ Web UI
1. ç™»å½• LangGraph Platform
2. ç‚¹å‡» "New Deployment"
3. é€‰æ‹© GitHub ä»“åº“
4. é…ç½®éƒ¨ç½²è®¾ç½®
5. ç‚¹å‡» "Deploy"

#### éƒ¨ç½²é…ç½®é€‰é¡¹
```yaml
# éƒ¨ç½²é…ç½®ç¤ºä¾‹
name: "my-agent-prod"
repository: "username/my-agent"
branch: "main"
environment: "production"
region: "us-east-1"
instance_type: "standard"
auto_deploy: true
environment_variables:
  - OPENAI_API_KEY: "sk-..."
  - LANGCHAIN_TRACING_V2: "true"
  - LOG_LEVEL: "INFO"
```

### 2. ç¯å¢ƒå˜é‡é…ç½®

#### åœ¨ Platform UI ä¸­è®¾ç½®
```bash
# å¿…éœ€çš„ç¯å¢ƒå˜é‡
OPENAI_API_KEY=sk-your_openai_api_key_here

# LangSmith è¿½è¸ªï¼ˆæ¨èï¼‰
LANGCHAIN_TRACING_V2=true
LANGCHAIN_API_KEY=your_langsmith_api_key
LANGCHAIN_PROJECT=my-agent-prod

# åº”ç”¨é…ç½®
LOG_LEVEL=INFO
MAX_WORKERS=4
REQUEST_TIMEOUT=30
```

#### æ•æ„Ÿä¿¡æ¯ç®¡ç†
- ğŸ” æ‰€æœ‰ç¯å¢ƒå˜é‡åŠ å¯†å­˜å‚¨
- ğŸ”„ æ”¯æŒè¿è¡Œæ—¶æ›´æ–°
- ğŸ” è®¿é—®å®¡è®¡æ—¥å¿—
- ğŸš« é˜²æ­¢æ„å¤–æ³„éœ²

### 3. è‡ªåŠ¨éƒ¨ç½²è®¾ç½®

#### GitHub Webhooks
è‡ªåŠ¨é…ç½®ï¼Œå½“ä»£ç æ¨é€æ—¶è§¦å‘éƒ¨ç½²ï¼š

```yaml
# .github/workflows/deploy.ymlï¼ˆå¯é€‰ï¼‰
name: Deploy to LangGraph Platform

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Deploy to LangGraph Platform
        run: |
          echo "éƒ¨ç½²ç”± LangGraph Platform è‡ªåŠ¨å¤„ç†"
```

#### åˆ†æ”¯ç­–ç•¥
```bash
# å¼€å‘ç¯å¢ƒï¼šdev åˆ†æ”¯
git checkout -b dev
git push origin dev

# æµ‹è¯•ç¯å¢ƒï¼šstaging åˆ†æ”¯
git checkout -b staging
git push origin staging

# ç”Ÿäº§ç¯å¢ƒï¼šmain åˆ†æ”¯
git checkout main
git push origin main
```

## å¤šç¯å¢ƒç®¡ç†

### ç¯å¢ƒç±»å‹
1. **å¼€å‘ç¯å¢ƒ (Development)**
   - åˆ†æ”¯ï¼š`dev`
   - å®ä¾‹ï¼šæœ€å°é…ç½®
   - ç”¨é€”ï¼šåŠŸèƒ½å¼€å‘å’Œæµ‹è¯•

2. **æµ‹è¯•ç¯å¢ƒ (Staging)**
   - åˆ†æ”¯ï¼š`staging`
   - å®ä¾‹ï¼šç”Ÿäº§ç›¸ä¼¼é…ç½®
   - ç”¨é€”ï¼šé›†æˆæµ‹è¯•å’ŒéªŒæ”¶

3. **ç”Ÿäº§ç¯å¢ƒ (Production)**
   - åˆ†æ”¯ï¼š`main`
   - å®ä¾‹ï¼šé«˜å¯ç”¨é…ç½®
   - ç”¨é€”ï¼šç”¨æˆ·è®¿é—®

### ç¯å¢ƒé…ç½®å·®å¼‚
```json
// langgraph.json - å¼€å‘ç¯å¢ƒ
{
  "dependencies": ["."],
  "graphs": {
    "my_agent": "./src/my_agent/graph.py:graph"
  },
  "env": ".env.dev",
  "python_version": "3.11"
}

// langgraph.json - ç”Ÿäº§ç¯å¢ƒ
{
  "dependencies": ["."],
  "graphs": {
    "my_agent": "./src/my_agent/graph.py:graph"
  },
  "env": ".env.prod",
  "python_version": "3.11",
  "dockerfile_lines": [
    "RUN apt-get update && apt-get install -y curl",
    "RUN pip install --no-cache-dir --upgrade pip"
  ]
}
```

## éƒ¨ç½²ç›‘æ§

### éƒ¨ç½²çŠ¶æ€æŸ¥çœ‹
```bash
# åœ¨ Platform UI ä¸­æŸ¥çœ‹ï¼š
# 1. éƒ¨ç½²çŠ¶æ€ï¼šæ„å»ºä¸­/æˆåŠŸ/å¤±è´¥
# 2. æ„å»ºæ—¥å¿—ï¼šè¯¦ç»†çš„æ„å»ºè¿‡ç¨‹
# 3. è¿è¡Œæ—¶æ—¥å¿—ï¼šåº”ç”¨æ‰§è¡Œæ—¥å¿—
# 4. æ€§èƒ½æŒ‡æ ‡ï¼šCPUã€å†…å­˜ã€è¯·æ±‚é‡
```

### æ—¥å¿—ç®¡ç†
```python
# åœ¨åº”ç”¨ä¸­é…ç½®æ—¥å¿—
import logging
import os

# é…ç½®æ—¥å¿—çº§åˆ«
log_level = os.getenv("LOG_LEVEL", "INFO")
logging.basicConfig(
    level=getattr(logging, log_level),
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.StreamHandler(),  # è¾“å‡ºåˆ°æ§åˆ¶å°
    ]
)

logger = logging.getLogger(__name__)

def my_node(state):
    logger.info(f"å¤„ç†è¯·æ±‚: {state.get('input', 'N/A')}")
    # èŠ‚ç‚¹é€»è¾‘
    return {"result": "processed"}
```

### å¥åº·æ£€æŸ¥
```python
# æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹
from fastapi import FastAPI
from langgraph.graph import StateGraph

app = FastAPI()

@app.get("/health")
async def health_check():
    """å¥åº·æ£€æŸ¥ç«¯ç‚¹"""
    return {
        "status": "healthy",
        "service": "my-agent",
        "version": "1.0.0"
    }

@app.get("/ready")
async def readiness_check():
    """å°±ç»ªæ£€æŸ¥ç«¯ç‚¹"""
    try:
        # æ£€æŸ¥ä¾èµ–æœåŠ¡
        # ä¾‹å¦‚ï¼šæ•°æ®åº“è¿æ¥ã€å¤–éƒ¨APIç­‰
        return {"status": "ready"}
    except Exception as e:
        return {"status": "not ready", "error": str(e)}
```

## API è®¿é—®

### è·å–éƒ¨ç½²ä¿¡æ¯
```python
# ä½¿ç”¨ LangGraph SDK
from langgraph_sdk import get_client

# è¿æ¥åˆ°éƒ¨ç½²çš„åº”ç”¨
client = get_client(
    url="https://your-deployment.langchain.app",
    api_key="your_api_key"
)

# åˆ—å‡ºå¯ç”¨çš„å›¾
graphs = client.assistants.search()
print(f"å¯ç”¨å›¾: {[g.name for g in graphs]}")

# åˆ›å»ºä¼šè¯
thread = client.threads.create()
print(f"ä¼šè¯ID: {thread.thread_id}")
```

### è°ƒç”¨éƒ¨ç½²çš„å›¾
```python
# åŒæ­¥è°ƒç”¨
response = client.runs.create(
    thread_id=thread.thread_id,
    assistant_id="my_agent",
    input={"input": "Hello, world!"}
)

# æµå¼è°ƒç”¨
for chunk in client.runs.stream(
    thread_id=thread.thread_id,
    assistant_id="my_agent",
    input={"input": "Tell me a story"},
    stream_mode="values"
):
    print(chunk)
```

### REST API è°ƒç”¨
```bash
# ç›´æ¥ä½¿ç”¨ HTTP API
curl -X POST "https://your-deployment.langchain.app/runs/stream" \
  -H "Authorization: Bearer your_api_key" \
  -H "Content-Type: application/json" \
  -d '{
    "assistant_id": "my_agent",
    "input": {"input": "Hello!"},
    "config": {"configurable": {"thread_id": "test-thread"}},
    "stream_mode": "values"
  }'
```

## æ‰©å±•é…ç½®

### å®ä¾‹ç±»å‹
```yaml
# å¯ç”¨å®ä¾‹ç±»å‹
instance_types:
  - name: "micro"
    cpu: "0.25 vCPU"
    memory: "0.5 GB"
    price: "$0.01/hour"

  - name: "small"
    cpu: "0.5 vCPU"
    memory: "1 GB"
    price: "$0.02/hour"

  - name: "standard"
    cpu: "1 vCPU"
    memory: "2 GB"
    price: "$0.04/hour"

  - name: "large"
    cpu: "2 vCPU"
    memory: "4 GB"
    price: "$0.08/hour"
```

### è‡ªåŠ¨æ‰©å±•
```json
{
  "scaling": {
    "min_instances": 1,
    "max_instances": 10,
    "target_cpu_utilization": 70,
    "scale_up_cooldown": "2m",
    "scale_down_cooldown": "5m"
  }
}
```

## ç‰ˆæœ¬ç®¡ç†

### éƒ¨ç½²ç‰ˆæœ¬
```bash
# æ¯æ¬¡éƒ¨ç½²éƒ½ä¼šåˆ›å»ºæ–°ç‰ˆæœ¬
# ç‰ˆæœ¬å‘½åè§„åˆ™ï¼šv1.0.0, v1.0.1, v1.1.0

# åœ¨ Platform UI ä¸­å¯ä»¥ï¼š
# 1. æŸ¥çœ‹ç‰ˆæœ¬å†å²
# 2. å›æ»šåˆ°ä¹‹å‰ç‰ˆæœ¬
# 3. æ¯”è¾ƒç‰ˆæœ¬å·®å¼‚
# 4. è®¾ç½®æµé‡åˆ†é…
```

### è“ç»¿éƒ¨ç½²
```yaml
# é›¶åœæœºéƒ¨ç½²ç­–ç•¥
deployment_strategy:
  type: "blue_green"
  health_check_path: "/health"
  health_check_interval: "30s"
  rollback_on_failure: true
```

### é‡‘ä¸é›€å‘å¸ƒ
```yaml
# æ¸è¿›å¼å‘å¸ƒ
deployment_strategy:
  type: "canary"
  stages:
    - percentage: 10
      duration: "10m"
    - percentage: 50
      duration: "20m"
    - percentage: 100
```

## æˆæœ¬ä¼˜åŒ–

### ä½¿ç”¨å»ºè®®
1. **é€‰æ‹©åˆé€‚çš„å®ä¾‹ç±»å‹**
   - å¼€å‘ç¯å¢ƒï¼šmicro/small
   - ç”Ÿäº§ç¯å¢ƒï¼šæ ¹æ®è´Ÿè½½é€‰æ‹©

2. **é…ç½®è‡ªåŠ¨æ‰©å±•**
   - é¿å…è¿‡åº¦é…ç½®
   - è®¾ç½®åˆç†çš„æ‰©å±•ç­–ç•¥

3. **ç›‘æ§èµ„æºä½¿ç”¨**
   - å®šæœŸæ£€æŸ¥ CPU/å†…å­˜ä½¿ç”¨ç‡
   - ä¼˜åŒ–ä»£ç æ€§èƒ½

### æˆæœ¬ç›‘æ§
```python
# åœ¨åº”ç”¨ä¸­æ·»åŠ æˆæœ¬è¿½è¸ª
import time
from functools import wraps

def track_execution_time(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        execution_time = time.time() - start_time

        # è®°å½•æ‰§è¡Œæ—¶é—´ï¼ˆç”¨äºæˆæœ¬åˆ†æï¼‰
        logger.info(f"Function {func.__name__} took {execution_time:.2f}s")
        return result
    return wrapper

@track_execution_time
def expensive_node(state):
    # è®¡ç®—å¯†é›†å‹æ“ä½œ
    return {"result": "computed"}
```

## æ•…éšœæ’é™¤

### å¸¸è§éƒ¨ç½²é”™è¯¯

#### 1. æ„å»ºå¤±è´¥
```bash
# é”™è¯¯ï¼šä¾èµ–å®‰è£…å¤±è´¥
ERROR: pip install failed

# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥ requirements.txt æ ¼å¼
# 2. ç¡®ä¿ç‰ˆæœ¬å…¼å®¹æ€§
# 3. æ·»åŠ  --no-cache-dir åˆ° dockerfile_lines
```

#### 2. å›¾åŠ è½½å¤±è´¥
```bash
# é”™è¯¯ï¼šæ— æ³•å¯¼å…¥å›¾å®šä¹‰
ImportError: cannot import name 'graph'

# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥ langgraph.json ä¸­çš„è·¯å¾„
# 2. ç¡®ä¿ __init__.py æ–‡ä»¶å­˜åœ¨
# 3. éªŒè¯å›¾å®šä¹‰è¯­æ³•
```

#### 3. ç¯å¢ƒå˜é‡é—®é¢˜
```bash
# é”™è¯¯ï¼šAPI å¯†é’¥æœªè®¾ç½®
KeyError: 'OPENAI_API_KEY'

# è§£å†³æ–¹æ¡ˆï¼š
# 1. åœ¨ Platform UI ä¸­è®¾ç½®ç¯å¢ƒå˜é‡
# 2. æ£€æŸ¥å˜é‡åæ‹¼å†™
# 3. éªŒè¯å˜é‡å€¼æ ¼å¼
```

### è°ƒè¯•æŠ€å·§

#### 1. æŸ¥çœ‹æ„å»ºæ—¥å¿—
```bash
# åœ¨ Platform UI ä¸­ï¼š
# Deployments â†’ é€‰æ‹©éƒ¨ç½² â†’ Build Logs
# æŸ¥çœ‹è¯¦ç»†çš„æ„å»ºè¿‡ç¨‹å’Œé”™è¯¯ä¿¡æ¯
```

#### 2. è¿è¡Œæ—¶è°ƒè¯•
```python
# æ·»åŠ è¯¦ç»†æ—¥å¿—
import logging
logging.basicConfig(level=logging.DEBUG)

def debug_node(state):
    logging.debug(f"èŠ‚ç‚¹è¾“å…¥: {state}")
    # å¤„ç†é€»è¾‘
    result = {"output": "processed"}
    logging.debug(f"èŠ‚ç‚¹è¾“å‡º: {result}")
    return result
```

#### 3. å¥åº·æ£€æŸ¥è°ƒè¯•
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
curl https://your-deployment.langchain.app/health

# æ£€æŸ¥åº”ç”¨å°±ç»ªçŠ¶æ€
curl https://your-deployment.langchain.app/ready
```

## å®‰å…¨æœ€ä½³å®è·µ

### 1. ç¯å¢ƒå˜é‡å®‰å…¨
- ğŸ” æ°¸è¿œä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
- ğŸ”„ å®šæœŸè½®æ¢ API å¯†é’¥
- ğŸš« ä¸è¦åœ¨æ—¥å¿—ä¸­è¾“å‡ºæ•æ„Ÿä¿¡æ¯

### 2. ç½‘ç»œå®‰å…¨
- ğŸŒ ä½¿ç”¨ HTTPS è¿›è¡Œæ‰€æœ‰é€šä¿¡
- ğŸ”’ é…ç½®é€‚å½“çš„ CORS ç­–ç•¥
- ğŸ›¡ï¸ å¯ç”¨è¯·æ±‚é€Ÿç‡é™åˆ¶

### 3. ä»£ç å®‰å…¨
```python
# é¿å…ä»£ç æ³¨å…¥
def safe_eval(user_input):
    # âŒ å±é™©åšæ³•
    # result = eval(user_input)

    # âœ… å®‰å…¨åšæ³•
    import ast
    try:
        parsed = ast.parse(user_input, mode='eval')
        # éªŒè¯ AST èŠ‚ç‚¹ç±»å‹
        return "safe"
    except:
        return "unsafe"
```

## ä¸‹ä¸€æ­¥

- ğŸ”§ æ¢ç´¢ [03-è‡ªæ‰˜ç®¡](./03-è‡ªæ‰˜ç®¡.md) - è‡ªä¸»æ§åˆ¶éƒ¨ç½²ç¯å¢ƒ
- ğŸ“Š å­¦ä¹  [04-ç›‘æ§ä¸è¿½è¸ª](./04-ç›‘æ§ä¸è¿½è¸ª.md) - æ·±å…¥ç›‘æ§å’Œè°ƒè¯•
- ğŸ” äº†è§£ [07-è®¤è¯ä¸æˆæƒ](./07-è®¤è¯ä¸æˆæƒ.md) - å¢å¼ºåº”ç”¨å®‰å…¨æ€§

## ç›¸å…³é“¾æ¥

- [LangGraph Platform å¿«é€Ÿå¼€å§‹](https://langchain-ai.github.io/langgraph/cloud/quick_start/)
- [Cloud SaaS éƒ¨ç½²æŒ‡å—](https://langchain-ai.github.io/langgraph/cloud/deployment/cloud/)
- [åº”ç”¨ç»“æ„é…ç½®](https://langchain-ai.github.io/langgraph/concepts/application_structure/)
- [LangGraph Platform æ¦‚å¿µ](https://langchain-ai.github.io/langgraph/concepts/langgraph_platform/)